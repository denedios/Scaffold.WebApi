# Structured Logging #

Scaffold uses the [Serilog](https://serilog.net) Logging Provider for structured logging. Before you can actually get structured logs, you'll need to configure a *sink* that can support structured logging. Serilog can be configured by modifying [Program.cs](../Sources/Scaffold.WebApi/Program.cs).

## Inbound HTTP Request Logging ##

Included in Scaffold is [RequestLoggingMiddleware](../Sources/Scaffold.WebApi/Middleware/RequestLoggingMiddleware.cs) that does the following;

1. Defines the log scope and logging context for log events.
2. Logs every inbound request.
3. Catches and logs unhandled exceptions.

The following is an example of a log entry generated by the *RequestLoggingMiddleware* when using a sink that supports the JSON formatter.

```json
{
    "Timestamp": "2019-07-30T08:20:39.8825889+10:00",
    "Level": "Information",
    "MessageTemplate": "Inbound HTTP {HttpMethod} {Path} responded with {StatusCode} in {ElapsedMilliseconds}ms",
    "Properties": {
        "HttpMethod": "GET",
        "Path": "/api/buckets",
        "StatusCode": 200,
        "ElapsedMilliseconds": 10,
        "SourceContext": "Scaffold.WebApi.Middleware.RequestLoggingMiddleware",
        "RequestId": "0HLOKEA46U3NP:00000005",
        "RequestPath": "/api/buckets",
        "CorrelationId": "0HLOKEA46U3NP:00000005",
        "ConnectionId": "0HLOKEA46U3NP",
        "HttpConnection": {
            "RemoteIpAddress": "::1",
            "LocalIpAddress": "::1"
        },
        "HttpRequest": {
            "Method": "GET",
            "Scheme": "http",
            "Host": "localhost:5000",
            "Path": "/api/buckets",
            "Headers": {
                "Cache-Control": "no-cache",
                "Connection": "keep-alive",
                "Content-Type": "application/json",
                "Accept": "*/*",
                "Accept-Encoding": "gzip, deflate",
                "Host": "localhost:5000",
                "User-Agent": "PostmanRuntime/7.6.0"
            }
        },
        "Application": "Scaffold.WebApi",
        "Environment": "Development"
    }
}
```

## Outbound HTTP Request Logging ##

Scaffold also includes a [delegating handler](https://docs.microsoft.com/aspnet/core/fundamentals/http-requests#outgoing-request-middleware) class called [RequestLoggingHttpMessageHandler](../Sources/Scaffold.WebApi/HttpMessageHandlers/RequestLoggingHttpMessageHandler.cs) that can be attached to instances of *HttpClient* to log outbound HTTP requests. Configure your HttpClients to use the *RequestLoggingHttpMessageHandler* in the [Startup](../Sources/Scaffold.WebApi/Startup.cs) class.

The following is an example of a log entry generated by the *RequestLoggingHttpMessageHandler* when using a sink that supports the JSON formatter.

```json
{
    "Timestamp": "2019-07-30T08:17:26.2567467+10:00",
    "Level": "Information",
    "MessageTemplate": "Outbound HTTP {HttpMethod} {Uri} responded with {StatusCode} in {ElapsedMilliseconds}ms",
    "Properties": {
        "HttpMethod": "GET",
        "Uri": "https://worldtimeapi.org/api/ip",
        "StatusCode": 200,
        "ElapsedMilliseconds": 1527,
        "SourceContext": "Scaffold.WebApi.HttpMessageHandlers.RequestLoggingHttpMessageHandler",
        "ActionId": "446f57ae-5e94-40c0-aae8-343fa7b4131a",
        "ActionName": "Scaffold.WebApi.Controllers.TestController.Get (Scaffold.WebApi)",
        "RequestId": "0HLOKEA46U3NP:00000001",
        "RequestPath": "/api/test/api/ip",
        "CorrelationId": "0HLOKEA46U3NP:00000001",
        "ConnectionId": "0HLOKEA46U3NP",
        "Scope": [
            "HTTP GET https://worldtimeapi.org/api/ip"
        ],
        "Application": "Scaffold.WebApi",
        "Environment": "Development"
    }
}
```
