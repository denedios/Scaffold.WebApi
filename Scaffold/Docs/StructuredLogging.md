# Structured Logging #

Scaffold uses the [Serilog](https://serilog.net) Logging Provider for structured logging. Before you can actually get structured logs, you'll need to configure a *sink* that can support structured logging. Serilog can be configured by modifying [Program.cs](../Sources/Scaffold.WebApi/Program.cs).

## Inbound HTTP Request Logging ##

Included in Scaffold is a [Request Logging Middleware](../Sources/Scaffold.WebApi/Middleware/RequestLoggingMiddleware.cs) that does the following;

1. Defines the log scope and logging context for log events.
2. Logs every inbound request.
3. Catches and logs unhandled exceptions.

The following is an example of a log entry generated by the Request Logging Middleware when using a sink that supports the JSON formatter.

```json
{
    "Timestamp": "2019-07-04T21:06:50.1610340+10:00",
    "Level": "Information",
    "MessageTemplate": "Inbound HTTP {Method} {Path} responded with {StatusCode} in {ElapsedMilliseconds}ms",
    "Properties": {
        "Method": "GET",
        "Path": "/health",
        "StatusCode": 200,
        "ElapsedMilliseconds": 11,
        "SourceContext": "Scaffold.WebApi.Middleware.RequestLoggingMiddleware",
        "RequestId": "0HLO0DUH515G7:00000004",
        "RequestPath": "/health",
        "CorrelationId": "0HLO0DUH515G7:00000004",
        "ConnectionId": "0HLO0DUH515G7",
        "HttpConnection": {
            "RemoteIpAddress": "::1",
            "LocalIpAddress": "::1"
        },
        "HttpRequest": {
            "Method": "GET",
            "Scheme": "http",
            "Host": "localhost:5000",
            "Path": "/health",
            "Headers": {
                "Cache-Control": "no-cache",
                "Connection": "keep-alive",
                "Accept": "*/*",
                "Accept-Encoding": "gzip, deflate",
                "Host": "localhost:5000",
                "User-Agent": "PostmanRuntime/7.6.0"
            }
        },
        "Application": "Scaffold.WebApi",
        "Environment": "Development"
    }
}
```

## Outbound HTTP Request Logging ##

Scaffold also includes a [Request Logging HTTP Message Handler](../Sources/Scaffold.WebApi/HttpMessageHandlers/RequestLoggingHttpMessageHandler.cs) which can be attached to a HttpClient used in your application to log outbound HTTP requests. Information on how to use this can be found [here](https://docs.microsoft.com/aspnet/core/fundamentals/http-requests#outgoing-request-middleware).

The following is an example of a log entry generated by the Request Logging HTTP Message Handler when using a sink that supports the JSON formatter.

```json
{
    "Timestamp": "2019-07-04T21:10:07.0178456+10:00",
    "Level": "Information",
    "MessageTemplate": "Outbound HTTP {HttpMethod} {Uri} responded with {StatusCode} in {ElapsedMilliseconds}ms",
    "Properties": {
        "HttpMethod": "GET",
        "Uri": "https://api.github.com/users/hannahchan",
        "StatusCode": 200,
        "ElapsedMilliseconds": 304,
        "SourceContext": "Scaffold.WebApi.HttpMessageHandlers.RequestLoggingHttpMessageHandler",
        "ActionId": "ec45920c-1a23-45a3-baac-c3ae2ac72ace",
        "ActionName": "Scaffold.WebApi.Controllers.TestController.Get (Scaffold.WebApi)",
        "RequestId": "0HLO0DUH515G7:00000006",
        "RequestPath": "/api/test",
        "CorrelationId": "0HLO0DUH515G7:00000006",
        "ConnectionId": "0HLO0DUH515G7",
        "Scope": [
            "HTTP GET https://api.github.com/users/hannahchan"
        ],
        "Application": "Scaffold.WebApi",
        "Environment": "Development"
    }
}
```
